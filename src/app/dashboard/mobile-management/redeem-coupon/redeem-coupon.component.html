<div id="scanner-container" class="bg-white">
  <zxing-scanner
    #scanner
    [(device)]="currentDevice"
    [tryHarder]="tryHarder"
    (scanSuccess)="onScanSuccess($event)"
    (permissionResponse)="onHasPermission($event)"
    (camerasFound)="onCamerasFound($event)"
  >
  </zxing-scanner>
</div>

<div id="scanned-qr-info" class="mt-3">
  <div class="card h-100">
    <div class="card-header p-1">
      <div class="d-flex justify-content-between align-items-center">
        <div class="align-items-center ml-2">
          {{ optionsVisible ? "Opciones de lector QR" : "Info de código QR" }}
        </div>

        <button
          type="button btn-sm"
          class="btn btn-outline-dark mr-2"
          (click)="toggleOptions()"
        >
          <i class="fa fa-cog" aria-hidden="true"></i>
        </button>
      </div>
    </div>

    <div class="card-body" *ngIf="!optionsVisible">
      <p *ngIf="!couponStatusRetrieved">
        Proceda a leer el código QR que desea canjear el cliente
      </p>

      <p *ngIf="this.coupon && this.customer">
        El código QR corresponde al cupón {{ this.coupon.title }}, intentando
        ser canjeado para el cliente
        {{ this.customer.firstName + " " + this.customer.lastName }}
      </p>

      <div *ngIf="couponStatusRetrieved">
        <hr *ngIf="this.coupon && this.customer" />
        <div
          class="alert alert-primary"
          role="alert"
          *ngIf="!notValid && !alreadyExpired && !alreadyRedeemed"
        >
          <p>El cupón puede ser canjeado</p>
        </div>

        <div
          class="alert alert-danger"
          role="alert"
          *ngIf="notValid || alreadyExpired || alreadyRedeemed"
        >
          <p *ngIf="notValid">
            Código QR no válido para esta operación. Valor del código:
            {{ this.scannedCode }}
          </p>

          <p *ngIf="alreadyRedeemed">
            Este cupón ya fue canjeado por el cliente el día {{ "" }} a las
            {{ "" }}.
          </p>

          <p *ngIf="alreadyExpired">
            Este cupón expiró. Fue válido hasta el día {{ "" }} a las {{ "" }}.
          </p>
        </div>
      </div>
    </div>
    <div class="card-body" *ngIf="optionsVisible">
      <label
        >Cámara actual:
        {{ currentDevice ? currentDevice.deviceId : "Ninguna" }}</label
      >
      <select
        class="form-control"
        (change)="onDeviceSelectChange($event.target.value)"
      >
        <option
          *ngFor="let device of availableDevices"
          [value]="device.deviceId"
          [selected]="
            currentDevice && device.deviceId === currentDevice.deviceId
          "
          >{{ device.label }}</option
        >
      </select>

      <div class="form-check mt-2">
        <input
          class="form-check-input"
          name="tryHarder"
          type="checkbox"
          [(ngModel)]="tryHarder"
          id="tryHarder"
        />
        <label class="form-check-label" for="tryHarder">
          Forzar
        </label>
      </div>

      <button
        class="btn btn-sm btn-outline-dark mt-2"
        (click)="askForPermissions()"
      >
        Pedir permisos
      </button>
    </div>
  </div>
</div>

<div class="card mt-3">
  <div class="card-body">
    <div class="d-flex justify-content-between bg-white">
      <button
        class="btn btn-outline-black"
        [disabled]="notValid || alreadyExpired || alreadyExpired"
      >
        Redimir cupón
      </button>
      <button class="btn btn-outline-danger" (click)="cleanScannedCode()">
        Limpiar código
      </button>
    </div>
  </div>
</div>
